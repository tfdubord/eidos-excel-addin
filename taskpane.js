!function(){"use strict";var e,t,a,n={14385:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},58394:function(e,t,a){e.exports=a.p+"1fda685b81e1123773f6.css"}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,s),a.exports}s.m=n,s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=a[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e}(),s.b=document.baseURI||self.location.href,function(){class e{constructor(e){this.Name=e,this.Type=1,this.Tags=new Array}addNumericTag(e,t,a){const n={Name:e,Type:t,Address:a};this.Tags.push(n)}addStringTag(e,t,a){const n={Name:e,Type:"STRING",Address:t,Length:a};this.Tags.push(n)}addBoolTag(e,t,a){const n={Name:e,Type:"BOOL",Address:t,BitAddress:a};this.Tags.push(n)}}class t{constructor(e){this.Name=e,this.TagGroups=new Array}}class a{constructor(e,t){this.Name=e,this.Tag=t}addValueDictionary(e){this.ValueDictionary=e}}class n{UseLegacyDataTypes=!1;constructor(e,t,a,n,o,s){this.Name=e,this.Type=t,this.TagSource=a,this.ServerAddress=n,this.ServerPort=65400,this.Database=o,this.Table=s,this.DataChannels=new Array,this.MetadataChannels=new Array}addDefaultShiftData(){this.ShiftSchedule={Shifts:[{Name:"Shift 1",Start:"07:00:00",End:"15:00:00"},{Name:"Shift 2",Start:"15:00:00",End:"23:00:00"},{Name:"Shift 3",Start:"-01:00:00",End:"07:00:00"}]}}addShiftSchedule(e){this.ShiftSchedule=JSON.parse(e)}addDataChannel(e,t,n){const o=new a(e,t);n&&o.addValueDictionary(n),this.DataChannels.push(o)}addMetadataChannel(e){this.MetadataChannels.push(e)}}Office.onReady((e=>{e.host===Office.HostType.Excel&&(document.getElementById("btnCreateMap").onclick=()=>g("Ex"),document.getElementById("btnCreateFile").onclick=d)}));const o="CONFIG",s="A2:C6",r="DS_Table",l="TagsMap_",c="BOOL,SINT,INT,DINT,REAL,STRING";var i=function(e){return e.StructuredText="ST",e.Ladder="LAD",e}(i||{}),u=function(e){return e.Integer="I",e.Byte="B",e}(u||{});function d(){(async function(e,t){return await Excel.run((async a=>{const n=a.workbook.worksheets.getItemOrNullObject(e);if(await a.sync(),n.isNullObject)return console.log("Cannot find CONFIG sheet"),await async function(){await Excel.run((async e=>{const t=e.workbook.worksheets.add(o),a=t.getRange(s);a.values=[["Tag Source Name","tag-source-name","<< this will also be used as the output file prefix"],["Server Address","server-name.x.com","<< port is hard-coded to EIDOS default of 65400"],["Database Name","database-name","<< Influx database name"],["Logic Type","ST","<< ST or LAD"],["Tag Name Format","B","<< byte (B) or index (I)"]],a.format.autofitColumns();const n=t.tables.add("A9:G10",!0);n.name=r,n.style="TableStyleLight1",n.getHeaderRowRange().values=[["Name","Table","Type","Trigger","ShiftSchedule","MetadataChannels","StaticMetadata"]],n.getDataBodyRange().values=[["","","Continuous","","","",""]],await e.sync(),console.log(`Added ${o} worksheet`)}))}(),await g("EX"),null;{let e=n.getRange(t).load(["values"]);return await a.sync(),{TagSourceName:e.values[0][1],ServerAddress:e.values[1][1],DatabaseName:e.values[2][1],LogicType:e.values[3][1],TagNameFormat:e.values[4][1]}}}))})(o,s).then((function(a){if(a){const o=function(e){return new t(e.TagSourceName)}(a);(async function(e,t){const a=new Array;return await Excel.run((async o=>{const s=o.workbook.tables.getItem(e),r=s.getHeaderRowRange().load("values"),l=s.getDataBodyRange().load("values");await s.context.sync();const c=r.values,i=l.values,u={};c[0].forEach(((e,t)=>{u[e]=t})),i.forEach((e=>{const o=e[u.Name],s=e[u.Table],r=e[u.Type],l=e[u.ShiftSchedule],c=e[u.MetadataChannels],i=e[u.StaticMetadata],d=new n(o,r,t.TagSourceName,t.ServerAddress,t.DatabaseName,s);try{const e=JSON.parse(c);d.MetadataChannels.push(e);const t=JSON.parse(i);d.StaticMetadata=t}catch(e){console.error(e)}l&&d.addShiftSchedule(l),a.push(d)}))})),a})(r,a).then((function(t){!async function(t,a,n){await Excel.run((async o=>{let s=o.workbook.worksheets;s.load("items/name"),await o.sync();for(const e of s.items)e.name.includes(l)&&(console.log(`Processing ${e.name}`),await r(n,e,a));async function r(a,n,s){if(n.tables.load("count"),await o.sync(),0==n.tables.count)return void console.log("Error: No table found on sheet");const r=n.tables.getItemAt(0).getDataBodyRange().load("values"),l=n.getRange("D1:E1").load("values");await o.sync();const c=l.values[0][0],i=(l.values[0][1],new e(c));for(let e of r.values){const t={Byte:e[0],Bit:e[1],ChannelName:e[2],DataSource:e[3],TagType:e[4],PlcTagName:e[5],PlcTagIndex:e[6],PlcTagBit:e[7]};if(t.IsBool=!!Number.isFinite(t.Bit),t.ChannelName){const e=a.TagNameFormat===u.Byte&&t.IsBool?`${c}[${t.Byte}].${t.Bit}`:a.TagNameFormat!==u.Byte||t.IsBool?a.TagNameFormat===u.Integer&&t.IsBool?`${c}[${t.PlcTagIndex}].${t.PlcTagBit}`:(a.TagNameFormat!==u.Integer||t.IsBool,`${c}[${t.PlcTagIndex}]`):`${c}[${t.Byte}]`;t.IsBool?i.addBoolTag(e,t.Byte,t.Bit):i.addNumericTag(e,t.TagType,t.Byte);const n=s.findIndex((e=>e.Name===t.DataSource));-1!=n&&s[n].addDataChannel(t.ChannelName,e)}}t.TagGroups.push(i)}console.log("Parse complete - object result:"),console.log(t),console.log(a)}))}(o,t,a)}))}}))}async function g(e){const t={horizontalAlignment:"Center",font:{bold:!0,size:13},fill:{color:"#FFC000"}},a={horizontalAlignment:"Left",font:{bold:!0,size:11,color:"White"},fill:{color:"#1F4E78"}};await Excel.run((async n=>{const o="TagsMap_"+e;let s=n.workbook.worksheets.getItemOrNullObject(o);if(await n.sync(),s.isNullObject){s=n.workbook.worksheets.add(o);const e=s.tables.add("A2:H2",!0);e.showBandedRows=!1,e.getHeaderRowRange().values=[["Byte","Bit","Eidos Chan Name","Table","Data Type","Source Data","Index PLC","Bit PLC"]];let r=[];for(let e=0;e<125;e++)r.push([4*e,"","","","","",e,""]);e.rows.add(null,r),e.getDataBodyRange().getColumn(4).dataValidation.rule={list:{inCellDropDown:!0,source:c}},s.activate(),s.tabColor="Green",e.getHeaderRowRange().format.set(a);let l=e.getHeaderRowRange(),i=[30,30,160,120,50,160,30,30];for(let e=0;e<i.length;e++)l.getColumn(e).format.columnWidth=i[e];let u=s.getRange("A1");u.values=[["EIDOS STUFF"]],u.format.set(t),s.getRange("A1:C1").merge(),s.getRange("D1").values=[["TAG_ARRAY_NAME"]];let d=s.getRange("E1");d.values=[["REAL"]],d.format.set(t),d.format.fill.color="#AEAAAA",d.dataValidation.rule={list:{inCellDropDown:!0,source:"DINT,REAL,UDT"}};let g=s.getRange("F1");g.values=[["PLC STUFF"]],g.format.set(t),s.getRange("F1:H1").merge(),console.log("TagsMap template sheet created")}else console.log("WARNING: TagsMap sheet already exists")}))}(class{static inEnum(e,t){return Object.values(e).includes(t)}}).inEnum(i,"ST1")}(),e=s(14385),t=s.n(e),a=new URL(s(58394),s.b),t()(a)}();
//# sourceMappingURL=taskpane.js.map