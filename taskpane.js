!function(){"use strict";var e,t,a,n={14385:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},58394:function(e,t,a){e.exports=a.p+"fabc0b66e735137afab0.css"}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var a=o[e]={exports:{}};return n[e](a,a.exports,s),a.exports}s.m=n,s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=a[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e}(),s.b=document.baseURI||self.location.href,function(){class e{constructor(e){this.Name=e,this.Type=1,this.Tags=new Array}addNumericTag(e,t,a){const n={Name:e,Type:t,Address:a};this.Tags.push(n)}addStringTag(e,t,a){const n={Name:e,Type:"STRING",Address:t,Length:a};this.Tags.push(n)}addBoolTag(e,t,a){const n={Name:e,Type:"BOOL",Address:t,BitAddress:a};this.Tags.push(n)}}class t{constructor(e){this.Name=e,this.TagGroups=new Array}}class a{constructor(e,t){this.Name=e,this.Tag=t}addValueDictionary(e){this.ValueDictionary=e}addTriggerSelf(e){const t={Tag:this.Tag,Type:e,Latch:!1};this.Trigger=t}}class n{UseLegacyDataTypes=!1;constructor(e,t,a,n,o,s){this.Name=e,this.UseLegacyDataTypes=!1,this.Type=t,this.TagSource=a,this.ServerAddress=n,this.ServerPort=65400,this.Database=o,this.Table=s,this.DataChannels=new Array,this.MetadataChannels=new Array}addDefaultShiftData(){this.ShiftSchedule={Shifts:[{Name:"Shift 1",Start:"07:00:00",End:"15:00:00"},{Name:"Shift 2",Start:"15:00:00",End:"23:00:00"},{Name:"Shift 3",Start:"-01:00:00",End:"07:00:00"}]}}addShiftSchedule(e){this.ShiftSchedule=JSON.parse(e)}addDataChannel(e,t,n){const o=new a(e,t);n&&o.addValueDictionary(n),"TriggeredChannels"==this.Type&&o.addTriggerSelf("OnChange"),this.DataChannels.push(o)}addMetadataChannel(e){this.MetadataChannels.push(e)}}function o(e,t){document.getElementById(e).innerHTML+="object"==typeof t?(JSON&&JSON.stringify?JSON.stringify(t,void 0,2):t)+"<br />":t+"<br />"}function s(e,t){const a=document.querySelectorAll("a.nav__link");console.log(a),a.forEach((t=>{t.id==e?t.className="nav__link nav-active":t.className="nav__link"})),document.querySelectorAll("div.panel").forEach((e=>{e.id==t?e.style.display="flex":e.style.display="none"}))}Office.onReady((e=>{e.host===Office.HostType.Excel&&(document.getElementById("btnCreateMap").onclick=()=>m("Ex"),document.getElementById("btnCreateFile").onclick=h,document.getElementById("nav__list-setup").onclick=()=>s("nav__list-setup","setup-panel"),document.getElementById("nav__list-make").onclick=()=>s("nav__list-make","make-panel"),document.getElementById("nav__list-help").onclick=()=>s("nav__list-help","help-panel"))}));const l="CONFIG",r="A2:C6",i="DS_Table",c="TagsMap_",d="BOOL,SINT,INT,DINT,REAL,STRING",u="log";var g=function(e){return e.Integer="I",e.Byte="B",e}(g||{});function h(){(async function(e,t){return await Excel.run((async a=>{const n=a.workbook.worksheets.getItemOrNullObject(e);if(await a.sync(),n.isNullObject)return console.log("Cannot find CONFIG sheet"),await f(),await m("EX"),null;{let e=n.getRange(t).load(["values"]);return await a.sync(),{TagSourceName:e.values[0][1],ServerAddress:e.values[1][1],DatabaseName:e.values[2][1],LogicType:e.values[3][1],TagNameFormat:e.values[4][1]}}}))})(l,r).then((function(a){if(a){const o=function(e){return new t(e.TagSourceName)}(a);(async function(e,t){const a=new Array;return await Excel.run((async o=>{const s=o.workbook.tables.getItem(e),l=s.getHeaderRowRange().load("values"),r=s.getDataBodyRange().load("values");await s.context.sync();const i=l.values,c=r.values,d={};i[0].forEach(((e,t)=>{d[e]=t})),c.forEach((e=>{const o=e[d.Name],s=e[d.Table],l=e[d.Type],r=e[d.ShiftSchedule],i=e[d.MetadataChannels],c=e[d.StaticMetadata],u=new n(o,l,t.TagSourceName,t.ServerAddress,t.DatabaseName,s);try{const e=JSON.parse(i);u.MetadataChannels.push(e);const t=JSON.parse(c);u.StaticMetadata=t}catch(e){console.error(e)}r&&u.addShiftSchedule(r),a.push(u)}))})),a})(i,a).then((function(t){(async function(t,a,n){await Excel.run((async o=>{let s=o.workbook.worksheets;s.load("items/name"),await o.sync();for(const e of s.items)e.name.includes(c)&&(console.log(`Processing ${e.name}`),await l(n,e,a));async function l(a,n,s){if(n.tables.load("count"),await o.sync(),0==n.tables.count)return void console.log("Error: No table found on sheet");const l=n.tables.getItemAt(0).getDataBodyRange().load("values"),r=n.getRange("D1:E1").load("values");await o.sync();const i=r.values[0][0],c=(r.values[0][1],new e(i));for(let e of l.values){const t={Byte:e[0],Bit:e[1],ChannelName:e[2],DataSource:e[3],TagType:e[4],PlcTagName:e[5],PlcTagIndex:e[6],PlcTagBit:e[7]};if(t.IsBool=!!Number.isFinite(t.Bit),t.ChannelName){const e=a.TagNameFormat===g.Byte&&t.IsBool?`${i}[${t.Byte}].${t.Bit}`:a.TagNameFormat!==g.Byte||t.IsBool?a.TagNameFormat===g.Integer&&t.IsBool?`${i}[${t.PlcTagIndex}].${t.PlcTagBit}`:(a.TagNameFormat!==g.Integer||t.IsBool,`${i}[${t.PlcTagIndex}]`):`${i}[${t.Byte}]`;t.IsBool?c.addBoolTag(e,t.Byte,t.Bit):c.addNumericTag(e,t.TagType,t.Byte);const n=s.findIndex((e=>e.Name===t.DataSource));-1!=n&&s[n].addDataChannel(t.ChannelName,e)}}t.TagGroups.push(c)}console.log("Parse complete - object result:"),console.log(t),console.log(a)}))})(o,t,a).then((function(){!function(e,t){const a=document.getElementById("downloads");for(;a.firstChild;)a.removeChild(a.firstChild);const n=function(e,t,a){let n=new Blob([JSON.stringify(e)],{type:"text/plain"}),o=document.createElement("a");o.text=`Download ${t}.json`,o.style.display="block",o.download=`${t}.json`;let s=URL.createObjectURL(n);o.href=s,a.appendChild(o)};n(e,`TS ${e.Name}`,a);for(let e of t)n(e,`${e.Name}`,a)}(o,t)}))}))}}))}async function f(){await Excel.run((async e=>{const t=e.workbook.worksheets.add(l),a=t.getRange(r);a.values=[["Tag Source Name","tag-source-name","<< this will also be used as the output file prefix"],["Server Address","server-name.x.com","<< port is hard-coded to EIDOS default of 65400"],["Database Name","database-name","<< Influx database name"],["Logic Type","ST","<< ST or LAD"],["Tag Name Format","B","<< byte (B) or index (I)"]],a.format.autofitColumns();const n=t.tables.add("A9:G10",!0);n.name=i,n.style="TableStyleLight1",n.getHeaderRowRange().values=[["Name","Table","Type","Trigger","ShiftSchedule","MetadataChannels","StaticMetadata"]],n.getDataBodyRange().values=[["","","Continuous","","","",""]],await e.sync(),console.log(`Added ${l} worksheet`)}))}async function m(e){const t={horizontalAlignment:"Center",font:{bold:!0,size:13},fill:{color:"#FFC000"}},a={horizontalAlignment:"Left",font:{bold:!0,size:11,color:"White"},fill:{color:"#1F4E78"}};await Excel.run((async n=>{const s="TagsMap_"+e;let r=n.workbook.worksheets.getItemOrNullObject(s);if(await n.sync(),r.isNullObject){r=n.workbook.worksheets.add(s);const e=r.tables.add("A2:H2",!0);e.showBandedRows=!1,e.getHeaderRowRange().values=[["Byte","Bit","Eidos Chan Name","Table","Data Type","Source Data","Index PLC","Bit PLC"]];let l=[];for(let e=0;e<125;e++)l.push([4*e,"","","","","",e,""]);e.rows.add(null,l),e.getDataBodyRange().getColumn(4).dataValidation.rule={list:{inCellDropDown:!0,source:d}},r.activate(),r.tabColor="Green",e.getHeaderRowRange().format.set(a);let i=e.getHeaderRowRange(),c=[30,30,160,120,50,160,30,30];for(let e=0;e<c.length;e++)i.getColumn(e).format.columnWidth=c[e];let g=r.getRange("A1");g.values=[["EIDOS STUFF"]],g.format.set(t),r.getRange("A1:C1").merge(),r.getRange("D1").values=[["TAG_ARRAY_NAME"]];let h=r.getRange("E1");h.values=[["REAL"]],h.format.set(t),h.format.fill.color="#AEAAAA",h.dataValidation.rule={list:{inCellDropDown:!0,source:"DINT,REAL,UDT"}};let f=r.getRange("F1");f.values=[["PLC STUFF"]],f.format.set(t),r.getRange("F1:H1").merge(),console.log("TagsMap template sheet created"),o(u,"TagsMap template sheet created")}else o(u,"WARNING: TagsMap sheet already exists");let i=n.workbook.worksheets.getItemOrNullObject(l);await n.sync(),i.isNullObject&&(o(u,"Config sheet not found, creating."),await f())}))}}(),e=s(14385),t=s.n(e),a=new URL(s(58394),s.b),t()(a)}();
//# sourceMappingURL=taskpane.js.map